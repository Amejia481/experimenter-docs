<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Experimenter Docs Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Experimenter Docs Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Experimenter Docs" href="/opensearch.xml"><title data-react-helmet="true">Feature Variables and Me | Experimenter Docs</title><meta data-react-helmet="true" property="og:url" content="https://experimenter.info/feature-variables-and-me"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Feature Variables and Me | Experimenter Docs"><meta data-react-helmet="true" name="description" content="About this document"><meta data-react-helmet="true" property="og:description" content="About this document"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://experimenter.info/feature-variables-and-me"><link data-react-helmet="true" rel="alternate" href="https://experimenter.info/feature-variables-and-me" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://experimenter.info/feature-variables-and-me" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.74449a08.css">
<link rel="preload" href="/assets/js/runtime~main.b1454bd4.js" as="script">
<link rel="preload" href="/assets/js/main.85d935e1.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Experimenter Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.svg" alt="Experimenter Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Experimenter Docs</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://experimenter.services.mozilla.com/nimbus/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Nimbus</a><a href="https://mana.mozilla.org/wiki/display/FJT/Project+Nimbus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Mana</a><a href="https://github.com/mozilla/experimenter-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Experimenter Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.svg" alt="Experimenter Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Experimenter Docs</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://experimenter.services.mozilla.com/nimbus/" target="_blank" rel="noopener noreferrer" class="menu__link">Nimbus</a></li><li class="menu__list-item"><a href="https://mana.mozilla.org/wiki/display/FJT/Project+Nimbus" target="_blank" rel="noopener noreferrer" class="menu__link">Mana</a></li><li class="menu__list-item"><a href="https://github.com/mozilla/experimenter-docs" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><main class="docMainContainer_3ufF docMainContainerEnhanced_3NYZ"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Feature Variables and Me</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="about-this-document"></a>About this document<a class="hash-link" href="#about-this-document" title="Direct link to heading">#</a></h2><p>This document is to illustrate the concepts of the Feature Variables feature of Nimbus, internally known as the Feature API.</p><p>The API used by software engineers is relatively small, so this document is not just for them. This document is also for designers, product managers and engineering managers who design, work on, and are responsible for features in the mobile apps we build. Successful experimentation requires multiple parts of the team to share an understanding of these concepts.</p><blockquote><p>üëã Information</p><p>Neither Nimbus, nor all of the Feature Variables work are finished yet, but they are certainly still useful. This document will talk about features that aren&#x27;t yet implemented, but will serve to illustrate the concepts. A sidebar like this will tell you when a feature isn&#x27;t ready.</p></blockquote><blockquote><p>‚õÖÔ∏èüî¨üî≠ Nomenclature</p><p>Much of the literature around the methodology of experiments Nimbus implements has its roots in medical testing. The feature variables API does not require understanding of double blind experiments or data-science, but this document will occasionally use words like &quot;treatment&quot; or &quot;exposure&quot;.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>The &quot;Feature&quot; in the &quot;Feature Variables API&quot; refers to features of the application. It&#x27;s pretty abstract, and how the application is divided up into features is up to the product teams. Over time, a feature may be involved in many experiments.</p><p>However, there is one rule:</p><blockquote><p>‚õÖÔ∏èüî¨üî≠ Concept</p><p><em>For a given user each feature can only be involved in one experiment at a time</em>.</p><p>If we see user change behavior after being exposed to an experimental treatment we need to be able to attribute it to that treatment, not another from a different experiment.</p></blockquote><p>One easy way to start thinking about features, would be to identify user-visible surfaces of the app: the <code>new-tab</code> screen, the <code>app-menu</code>, the <code>context-menu</code>, the <code>onboarding</code>.</p><p>Imagine you&#x27;re a designer, doing a re-design of the app&#x27;s menu. It would be natural to call the app menu a &quot;feature&quot; of the app.</p><p>You&#x27;ve got some hypotheses around the icons, and whether they should be to right or left of the text. There is also some uncertainty around the copy for each menu item.</p><p>The uncertainties and hypotheses you have might translate into variations and variables you might configure the menu with. If these variables and variations are documented, they should travel as an adjunct to or part of the design itself. Later these will be turned into a more formal document that lives with the code, but it is at this stage when they should be thought about.</p><p>To narrow the scope for documentation purposes, we&#x27;ll focus on a small number of variables. Within the <code>app-menu</code> feature, we&#x27;ll consider the menu being made up of menu items, and we&#x27;ll zoom in on the settings menu item.</p><p>As a team communication tool, it may help to consider a JSON object to enumerate the variables that are configurable for the settings icon, and their defaults.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><div tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;settings-menu-item-title&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Settings&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;settings-menu-item-icon&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ic_settings&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;settings-menu-item-enabled&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;settings-menu-item-action&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;firefox://settings&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This JSON object looks like what experimenters will be putting into branch configuration screens in Experimenter, under Feature Configuration.</p><p>Where did these keys come from? This is not up to Nimbus, but up to the app, i.e. the app team. In this hypothetical case, you have some theories about the title and the icon, and now the app needs to get those values from nimbus.</p><blockquote><p>‚õÖÔ∏èüî¨üî≠  Naming Convention</p><p>Nimbus doesn&#x27;t take a view on how you arrange the JSON, but by convention, like all other identifiers, it prefers kebab-case (i.e. lower-case-words-joined-with-dashes).</p></blockquote><p>In the app code, the <code>Variables</code> object is a wrapper around this JSON object, and we have a number of getters to get values out. Notice that all getters return optional types, so it is up to the app developer to provide a default value.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly swift"><div tabindex="0" class="prism-code language-swift codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">let variables = nimbus.getVariables(&quot;app-menu&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">let action: String = variables.getString(&quot;settings-menu-item-action&quot;) ?? &quot;firefox://settings&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">let title: String = variables.getText(&quot;settings-menu-item-title&quot;) ?? Strings.AppMenuSettingsTitle</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">let icon: UIImage = variables.getImage(&quot;settings-menu-item-icon&quot;) ?? UIImage(named: &quot;icon-photon-gear&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">let isEnabled: Bool = variables.getBool(&quot;settings-menu-item-enabled&quot;) ?? true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>It is a similar story in Kotlin:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><div tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">val variables = nimbus.getVariables(&quot;app-menu&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val action: String = variables.getString(&quot;settings-menu-item-action&quot;) ?: &quot;firefox://settings&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val title: String = variables.getText(&quot;settings-menu-item-title&quot;) ?: context.getString(R.string.app_menu_settings_title)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val icon: Drawable = variables.getDrawable(&quot;settings-menu-item-icon&quot;) ?: context.getDrawable(R.drawable.ic_settings)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val isEnabled: Bool = variables.getBool(&quot;settings-menu-item-enabled&quot;) ?? true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>A few things to talk about here:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="fundamental-types-strings-int-bool"></a>Fundamental types: Strings, Int, Bool<a class="hash-link" href="#fundamental-types-strings-int-bool" title="Direct link to heading">#</a></h3><p><code>getString()</code>, <code>getBool()</code> and <code>getInt()</code> all return values as found in the JSON. If there is a disagreement about types, i.e. if the app is expecting a string, and the value in the JSON is an integer, the app gets <code>nil</code> or <code>null</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="everything-is-optional"></a>Everything is optional<a class="hash-link" href="#everything-is-optional" title="Direct link to heading">#</a></h3><p>If the app asks for a variable that is not specified in this particular experiment, then it gets back <code>nil</code> or <code>null</code>.</p><p>It is thus imperative that the app has a reasonable default. On the other hand, this allows us to have experiments which configure only small parts of a feature.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="text-resources"></a>Text resources<a class="hash-link" href="#text-resources" title="Direct link to heading">#</a></h3><p>In the example above, the title uses <code>getText()</code>. This gets a string value with <code>getString()</code>. The value is then used as a key to look up the app resource string.</p><p>For example, on Android: <code>getText(&quot;settings-menu-item-title&quot;)</code> may get a string from the JSON <code>&quot;app_menu_settings_title&quot;</code>, which is then resolves to <code>R.string.app_menu_settings_title</code> which is then used to look up the String in the <code>Resources</code>.</p><p>On iOS, <code>getText</code> uses a similar process via <code>LocalizedString</code> to look up the translated strings. You can specify the <code>tableName</code> as well as the <code>key</code> in the single value by joining it with a slash.</p><p>For example, <code>getText(&quot;settings-menu-item-title&quot;)</code> may get a string from the JSON <code>&quot;AppMenu/SettingsTitle&quot;</code> which uses <code>bundle.localizedString(&quot;SettingsTitle&quot;, tableName: &quot;AppMenu&quot;)</code> to look up a localized string. If the app doesn&#x27;t use <code>tableName</code>, then you can omit it: e.g. <code>AppMenu_SettingsTitle</code> would look for <code>NSLocalizedString(&quot;AppMenu_SettingsTitle&quot;)</code>.</p><p>If <code>getString()</code> returned a string, and the resource lookup didn&#x27;t succeed, <code>getText()</code> falls back to the string.</p><p>This means that you can use either pre-translated strings to try out experiments across locales, or target your experiment on a single language.</p><blockquote><p>üéõ Configuration</p><p>Resource lookup via <code>Bundle</code> and <code>Context</code> uses the objects passed to nimbus at construction time at app-startup. In Firefox for iOS and Fenix this is <code>Bundle.main</code> and <code>context.applicationContext</code> respectively.</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="-image-resources"></a>üì∑ Image resources<a class="hash-link" href="#-image-resources" title="Direct link to heading">#</a></h3><p>In the example above, the <code>icon</code> uses <code>getImage()</code> and its Android analog <code>getDrawable()</code>. This gets a string value from the JSON with <code>getString()</code> and then uses that value to look up the pre-bundled resource.</p><p>For example on Android: <code>getDrawable(&quot;settings-menu-item-icon&quot;)</code> uses <code>getString(&quot;settings-menu-item-icon&quot;)</code> which might get the value <code>&quot;ic_settings&quot;</code> from JSON. This is then resolved to <code>R.drawable.ic_settings</code>, which is then resolved to <code>context.resources.getDrawable(R.drawable.ic_settings)</code>.</p><p>On iOS: <code>getImage(&quot;settings-menu-item-icon&quot;)</code> uses <code>getString(&quot;settings-menu-item-icon&quot;)</code> which might get the value <code>&quot;icon_photon_gear&quot;</code>, which is then used to get the named <code>UIImage</code> with <code>UIImage(named:in:)</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="making-json-more-manageable"></a>Making JSON more manageable<a class="hash-link" href="#making-json-more-manageable" title="Direct link to heading">#</a></h2><p>We focused on the settings menu item in the above example, as a way of making a small enough example to reason about in this documentation, but it made for some very long variable names. The <code>Variables</code> object has itself a <code>getVariables(key: String)</code> method to make navigating the JSON more easily. This in turn allows the JSON to be organized in different ways.</p><p>Zooming out of our example above, which had just one menu item: we can re-arrange the JSON to accommodate multiple menu items, with a simpler nested structure:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><div tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;settings&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;icon&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ic_settings&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;title&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Settings&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;action&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;firefox://settings&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;enabled&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;bookmarks&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;icon&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ic_bookmarks&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;title&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;View Bookmarks&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;action&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;firefox://bookmark_list&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;enabled&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;history&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;icon&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ic_history&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;title&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;View History&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;action&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;firefox://history_list&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;enabled&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This might be accessed in Kotlin with:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><div tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">val menuVariables = nimbus.getVariables(&quot;app-menu&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">var settingsItem = menuVariables.getVariables(&quot;settings&quot;).let { vars -&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val action: String = vars?.getString(&quot;action&quot;) ?: &quot;firefox://settings&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val title: String = vars?.getText(&quot;title&quot;) ?: context.getString(R.string.app_menu_settings_title)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val icon: Drawable = vars?.getDrawable(&quot;icon&quot;) ?: context.getDrawable(R.drawable.ic_settings)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    MenuItem(icon, title, action)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>In Swift:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly swift"><div tabindex="0" class="prism-code language-swift codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">let menuVariables = nimbus.getVariables(&quot;app-menu&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">let settingsItem = menuVariables.getVariables(&quot;settings&quot;).let { vars -&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    let action: String = vars?.getString(&quot;action&quot;) ?? &quot;firefox://settings&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    let title: String = vars?.getText(&quot;title&quot;) ?? Strings.AppMenuSettingsTitle</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    let icon: UIImage = vars?.getImage(&quot;icon&quot;) ?? UIImage(named: &quot;icon-photon-gear&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    let isEnabled: Bool = vars?.getBool(&quot;enabled&quot;) ?? true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    MZMenuItem(icon: icon, title: title, action: action)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><blockquote><p>üëã Information</p><p><code>variables.getVariables()</code> can be arbitrarily deep. <code>variables.getVariables()</code> returns an optional <code>Variables</code> object.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="recording-exposure-events"></a>Recording exposure events<a class="hash-link" href="#recording-exposure-events" title="Direct link to heading">#</a></h2><blockquote><p>‚õÖÔ∏èüî¨üî≠ Enrollment versus Exposure</p><p>When a client is selected to take part in an experiment, they are <em>assigned</em> a branch. This is <em>enrollment</em>.</p><p>However, the user may not be <em>exposed</em> to the branch until sometime later. The exposure is the earliest moment that the user could be affected by the experimental treatment.</p><p>Nimbus records the enrollments and exposure events using Glean.</p><p>Enrollments are recorded at each app start-up, and exposure events each time an exposure happens.</p></blockquote><p>For experiments in Firefox for iOS and Android, enrollment happens shortly after app-startup.</p><p>In our example above, the app menu is constructed when a tab is open. The user is only exposed to the values of the JSON when they tap on the open-menu icon.</p><p>By default, exposure is recorded when <code>nimbus.getVariables(featureId: String)</code> is called. Whichever experiment the feature is enrolled in‚Äî always exactly zero or one‚Äî has an exposure event recorded.</p><p>A second, optional argument is allowed for this method <code>getVariables</code>, to change this default behavior.</p><p>Here, the menu is constructed with variables from Nimbus, but the user doesn&#x27;t see the menu until they open it.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly kotlin"><div tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">val menu = createMenu(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    nimbus.getVariables(&quot;app-menu&quot;, sendExposureEvents = false)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val menuButton = Button(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    icon = R.drawable.ic_menu,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    onButtonPressed = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        nimbus.recordExposureEvent(&quot;app-menu&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        show(menu)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This is a caricature of the same code in Swift.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly swift"><div tabindex="0" class="prism-code language-swift codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">let menuSheet = createMenuSheet(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    nimbus.getVariables(&quot;app-menu&quot;, sendExposureEvents: false)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">let menuButton = UIButton()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">menuButton.addTarget(self, action: #selector(didOpenMenu), for: .touchUpInside)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">func didOpenMenu() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    let nimbus = Nimbus.shared</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    nimbus.recordExposureEvent(&quot;app-menu&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    viewController.present(menuSheet, animated: true, completion: nil)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Nimbus will take care of finding out what experiment, if any, the user is enrolled in when using this feature.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="using-configurable-features-to-experiment-with-another"></a>Using configurable features to experiment with another<a class="hash-link" href="#using-configurable-features-to-experiment-with-another" title="Direct link to heading">#</a></h2><p>The feature itself may be configurable, but we don&#x27;t have to limit feature configuration to experiments <em>about that feature</em>.</p><p>We can imagine a world where we have multiple configurable features, say: an <code>app-menu</code>, <code>onboarding</code> and <code>newtab</code>. On each of these features we have a messaging surface, and we want to run an experiment to find which is the best surface to show the message about a behavior we wish to maximize: setting the browser to be the device default.</p><p>Can we configure an experiment to test each of the message on each of these messaging surfaces?</p><blockquote><p>üëã Unimplemented</p><p><em>Coming soon</em> While this is available in Experimenter, currently the Nimbus SDK does not support different features in different branches.</p></blockquote><p>We might also imagine a world where we have multiple features as before. Two different product teams are experimenting with two new capabilities of the app: both require onboarding instructions, one has an entry point via a app menu item, and the other has an entry point in the new tab screen.</p><p>If it was one product team where communication is high, perhaps they might run one experiment, with two treatment branches: one branch with configuration for the <code>onboarding</code> and <code>app-menu</code> features, and one branch with configuration for the <code>onboarding</code> and <code>new-tab</code> features.</p><p>Both teams require the <code>onboarding</code> feature. This allows each team to run their own experiments, which do not interfere with one another.</p><blockquote><p>‚õÖÔ∏èüî¨üî≠  Concept</p><p>While for any given user a feature may be involved in only one experiment, one experiment should be able to configure multiple features.</p></blockquote><p>Because both product teams&#x27; experiments require the <code>onboarding</code> experiment, no user will be involved in <em>both</em> experiments.</p><blockquote><p>üëã Unimplemented</p><p><em>Coming soon</em> Configuring multiple features per branch isn&#x27;t yet in Experimenter.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="Ô∏è-working-with-configurable-features"></a>üîß‚öôÔ∏è Working with configurable features<a class="hash-link" href="#Ô∏è-working-with-configurable-features" title="Direct link to heading">#</a></h2><p>Throughout the process of designing and building these configurable features, the feature variables have needed to be documented. At first, when the feature is being envisioned and designed, the variables should travel with the designs themselves.</p><p>When the feature is being implemented, these variables will begin to acquire concrete names, types and organization, which will be used extract JSON from the Nimbus SDK and configure the application features themselves. This documentation will begin to take shape and textual organization that travel in the app&#x27;s repository.</p><p>When the feature is being tested, QA testers are going to want to configure the features within bounds and tolerances set by the designs and the engineers.</p><p>Finally, when the feature is part of experiments, then the experiment owner, setting the branches in Experimenter needs to be able configure the branches with variables with spellings and organization that match the app implementation.</p><p>It&#x27;s strongly recommended that you keep a track of these identifiers and descriptions of the configurability of each of the features in at least one place. After implementing a configurable feature, it should probably live with the code repository, so it can versioned and tracked with the code.</p><blockquote><p>üëã Unimplemented</p><p>The Nimbus team has a few ideas about this, for documenting the features in an app in a machine readable format, tentatively called the Manifest. We&#x27;re thinking:</p><ol><li>generating code for app developers to use in app code<ul><li>managing defaults values</li><li>removing magic strings</li></ul></li><li>automating the registering of feature ids to Experimenter<ul><li>currently this needs an Experimenter reviewer or admin.</li></ul></li><li>generating Experimenter UI for experimenters to use in experiment branch design</li><li>generating on-device tools for feature testing, branch design and local development.</li></ol><p>We&#x27;re in the early stages of planning this, so would love to hear some feedback or ideas you may have.</p></blockquote></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/mozilla/experimenter-docs/edit/main/docs/feature-variables-and-me.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#about-this-document" class="table-of-contents__link">About this document</a></li><li><a href="#introduction" class="table-of-contents__link">Introduction</a><ul><li><a href="#fundamental-types-strings-int-bool" class="table-of-contents__link">Fundamental types: Strings, Int, Bool</a></li><li><a href="#everything-is-optional" class="table-of-contents__link">Everything is optional</a></li><li><a href="#text-resources" class="table-of-contents__link">Text resources</a></li><li><a href="#-image-resources" class="table-of-contents__link">üì∑ Image resources</a></li></ul></li><li><a href="#making-json-more-manageable" class="table-of-contents__link">Making JSON more manageable</a></li><li><a href="#recording-exposure-events" class="table-of-contents__link">Recording exposure events</a></li><li><a href="#using-configurable-features-to-experiment-with-another" class="table-of-contents__link">Using configurable features to experiment with another</a></li><li><a href="#Ô∏è-working-with-configurable-features" class="table-of-contents__link">üîß‚öôÔ∏è Working with configurable features</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2021 Mozilla Corporation</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b1454bd4.js"></script>
<script src="/assets/js/main.85d935e1.js"></script>
</body>
</html>