<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Experimenter Docs Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Experimenter Docs Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Experimenter Docs" href="/opensearch.xml"><title data-react-helmet="true">Configuring Jetstream | Experimenter Docs</title><meta data-react-helmet="true" property="og:url" content="https://experimenter.info/jetstream/configuration"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Configuring Jetstream | Experimenter Docs"><meta data-react-helmet="true" name="description" content="About configurations"><meta data-react-helmet="true" property="og:description" content="About configurations"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://experimenter.info/jetstream/configuration"><link data-react-helmet="true" rel="alternate" href="https://experimenter.info/jetstream/configuration" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://experimenter.info/jetstream/configuration" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.74449a08.css">
<link rel="preload" href="/assets/js/runtime~main.a5111cd0.js" as="script">
<link rel="preload" href="/assets/js/main.85d935e1.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Experimenter Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.svg" alt="Experimenter Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Experimenter Docs</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://experimenter.services.mozilla.com/nimbus/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Nimbus</a><a href="https://mana.mozilla.org/wiki/display/FJT/Project+Nimbus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Mana</a><a href="https://github.com/mozilla/experimenter-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Experimenter Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.svg" alt="Experimenter Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Experimenter Docs</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://experimenter.services.mozilla.com/nimbus/" target="_blank" rel="noopener noreferrer" class="menu__link">Nimbus</a></li><li class="menu__list-item"><a href="https://mana.mozilla.org/wiki/display/FJT/Project+Nimbus" target="_blank" rel="noopener noreferrer" class="menu__link">Mana</a></li><li class="menu__list-item"><a href="https://github.com/mozilla/experimenter-docs" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Welcome</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contributing">Contributing</a></li><li class="menu__list-item"><a href="https://mana.mozilla.org/wiki/x/XdTNBw" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Design Process</a></li><li class="menu__list-item"><a href="https://mana.mozilla.org/wiki/display/FJT/Nimbus+Onboarding#NimbusOnboarding-Branches" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Nimbus Onboarding</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Experiment Owners</a><ul class="menu__list"><li class="menu__list-item"><a href="https://docs.google.com/document/d/155EUgzn22VTX8mFwesSROT3Z6JORSfb5VyoMoLra7ws" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Experimentation with Nimbus</a></li><li class="menu__list-item"><a href="https://docs.google.com/document/d/155EUgzn22VTX8mFwesSROT3Z6JORSfb5VyoMoLra7ws/edit#heading=h.75kfit458h84" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Monitoring and Analyzing your Experiment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/console/custom-audiences">Custom Audiences</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/console/preview">Previewing Experiments</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Jetstream</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/jetstream/jetstream">Jetstream overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/jetstream/metrics">Metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/jetstream/statistics">Statistics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/jetstream/outcomes">Outcomes</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/jetstream/configuration">Configuring Jetstream</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/jetstream/data-products">Jetstream Data Products</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/jetstream/operations">Jetstream Architecture and Operations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/jetstream/troubleshooting">Troubleshooting Jetstream</a></li><li class="menu__list-item"><a href="https://github.com/mozilla/jetstream" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="0">GitHub Repo</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Data Scientists</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/data-scientists">Experimentation for data scientists</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Fenix Engineers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fenix-engineers">Implementing an experiment</a></li><li class="menu__list-item"><a href="https://docs.google.com/document/d/1kchihPal0__A4VOAiPJarNuZXns5KhOHHfIeIzT6zfU/edit#" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Android API (proposal)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/jetstream/feature-variables-and-me">Feature Variables API</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Firefox for iOS Engineers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/jetstream/feature-variables-and-me">Feature Variables API</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Fenix Testing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/android-frontend-testing">Testing on mobile</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Desktop Engineers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/desktop-feature-api">Nimbus Feature API (JS)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/desktop-migration-guide">Migration Guide (JS)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/desktop-rollouts">Desktop Rollouts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/desktop-frontend-testing">Desktop Front-end testing</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Core Nimbus Team</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/android-feature-api">PROPOSAL - Android Feature API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/client-sdk-states-and-lifecycle">Client SDK States &amp; Lifecycle</a></li><li class="menu__list-item"><a href="https://github.com/mozilla/experimenter" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Experimenter GH Repo</a></li><li class="menu__list-item"><a href="https://mana.mozilla.org/wiki/display/FJT/How+to+Launch+a+Nimbus+Experiment" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">How to Launch a Nimbus Experiment</a></li><li class="menu__list-item"><a href="https://mana.mozilla.org/wiki/pages/viewpage.action?pageId=130920248" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Nimbus Data Transfer Object</a></li><li class="menu__list-item"><a href="https://mana.mozilla.org/wiki/display/FJT/Nimbus+Engineering#NimbusEngineering-ExperimentTelemetry" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Experiment Telemetry</a></li><li class="menu__list-item"><a href="https://mana.mozilla.org/wiki/display/FJT/Lessons+Learned+-+Experiment+Incidents+and+Close+Calls" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Lessons Learned</a></li></ul></li></ul></div><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" role="img" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Configuring Jetstream</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="about-configurations"></a>About configurations<a class="hash-link" href="#about-configurations" title="Direct link to heading">#</a></h2><p>There are two ways to customize the results that appear in Experimenter and <a href="https://protosaur.dev/partybal/" target="_blank" rel="noopener noreferrer">partybal</a> for an experiment.</p><p>You can either reference an <a href="/jetstream/outcomes">outcome</a> while creating the experiment in the console,
or commit a custom configuration to the <a href="https://github.com/mozilla/jetstream-config" target="_blank" rel="noopener noreferrer">jetstream-config</a> repository.</p><p>Outcome definitions are also created in jetstream-config and use the same configuration language.</p><p>Custom experiment configurations are associated with an experiment by their filename,
which should match the experiment slug, like <code>my-experiment-slug.toml</code>.
This works for both Normandy and Nimbus slugs.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="landing-configurations"></a>Landing configurations<a class="hash-link" href="#landing-configurations" title="Direct link to heading">#</a></h2><p>To add or update a custom configuration, open a pull request against <a href="https://github.com/mozilla/jetstream-config" target="_blank" rel="noopener noreferrer">jetstream-config</a>.
CI checks will validate the columns, data sources, and SQL syntax.
Once CI completes, you may merge the pull request, which will trigger Jetstream to re-run your analysis.
No additional review is necessary to land configurations.</p><p>Note that rerunning experiments may be costly!
Don&#x27;t let this stop you from doing your job,
but try to avoid too much iteration on large and long-running experiments.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="configuration-file-syntax"></a>Configuration file syntax<a class="hash-link" href="#configuration-file-syntax" title="Direct link to heading">#</a></h2><p>Custom configs for <a href="#custom-experiment-configurations">experiments</a> and <a href="#outcome-snippets">outcome snippets</a>
analyzed in <a href="https://github.com/mozilla/jetstream" target="_blank" rel="noopener noreferrer">jetstream</a> use the same configuration language.</p><p>Custom configuration files are written in <a href="https://toml.io/en/" target="_blank" rel="noopener noreferrer">TOML</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="custom-experiment-configurations"></a>Custom experiment configurations<a class="hash-link" href="#custom-experiment-configurations" title="Direct link to heading">#</a></h3><p>Configuration files have four main sections:
<a href="#experiment-section"><code>[experiment]</code></a>, <a href="#metrics-section"><code>[metrics]</code></a>, <a href="#defining-data-sources"><code>[data_sources]</code></a>,
and <a href="#defining-segments"><code>[segments]</code></a>.</p><p>Examples of every value you can specify in each section are given below.
You do not need to, and should not, specify everything!
Jetstream will take values from Experimenter
and combine them with a reasonable set of defaults.</p><p>Lines starting with a <code>#</code> are comments and have no effect.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="experiment-section"></a>Experiment section<a class="hash-link" href="#experiment-section" title="Direct link to heading">#</a></h3><p>This part of the configuration file lets you</p><ul><li>specify the segments you wish to analyze,</li><li>override some values from Experimenter, and</li><li>define an exposure signal for your experiment.</li></ul><p>Segments are subsets of your enrolled population,
and depend on some factor that could be observed about the client
before they enrolled in the experiment.</p><p>Some segments <a href="https://docs.telemetry.mozilla.org/concepts/segments.html" target="_blank" rel="noopener noreferrer">are described in DTMO</a>,
and there are lists of predefined segments in the
<a href="https://mozilla.github.io/mozanalysis/api/segments/desktop.html" target="_blank" rel="noopener noreferrer">mozanalysis documentation</a>.</p><p>You can also override some values from Experimenter in the experiment section.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><div tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[experiment]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># The segments that you wish to compute metrics for.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># You can define your own later in the configuration,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># or (more commonly) use a value from mozanalysis.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># The segment of all users is always computed.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">segments = [&quot;is_regular_user_v3&quot;, &quot;new_or_resurrected_v3&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Nominal length of the enrollment period in days.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Mozanalysis will consider enrollment_period + 1 &quot;dates&quot; of enrollments.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">enrollment_period = 7</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># The name of the control branch.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># To compare all branches to each other pairwise, use the value `nan`.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">reference_branch = &quot;control&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Override the &quot;enrollment query&quot; mozanalysis will use.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># See https://github.com/mozilla/mozanalysis/issues/93 for more details about</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># what the query needs to contain.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># It must yield columns named client_id, branch, enrollment_date, and num_enrollment_events.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Jetstream interprets this as a Jinja2 template; an `experiment` object is provided</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># that lets you access other details from Experimenter, like a slug.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">enrollment_query = &quot;&quot;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SELECT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      client_id,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      branch,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      enrollment_date,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      num_enrollments</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  FROM mozdata.some_table.name_here</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  WHERE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      DATE(submission_timestamp) BETWEEN &quot;{{experiment.start_date_str}}&quot; AND &quot;{{experiment.last_enrollment_date_str}}&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      AND mozfun.map.get_key(environment.experiments, &quot;{{experiment.slug}}&quot;) IS NOT NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;&quot;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># You can override either or both of the start_date and end_date.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># In conjunction with a custom enrollment query, this can be useful for holdbacks,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># since you don&#x27;t really care about the period of time before your client upgrades</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># to the new version.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">start_date = &quot;2020-01-01&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end_date = &quot;2020-12-31&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># If you need Jetstream to decline to run analysis for an experiment,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># you can set this to true.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">skip = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># You can override the exposure signal for the experiment if one is useful.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># We&#x27;ll default to the Nimbus exposure event if one is not specified here.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[experiment.exposure_signal]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">name = &quot;nimbus&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">friendly_name = &quot;Nimbus exposure signal&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">description = &quot;Nimbus desktop feature exposure signal&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">data_source = &quot;normandy_events&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">select_expression = &quot;event_method = &#x27;expose&#x27; AND event_string_value = &#x27;my_slug&#x27;&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>You should not define a <code>start_date</code> and <code>end_date</code> in your Jetstream configuration
unless it is important for your analysis that the deployment period is not the same as the analysis period.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="metrics-section"></a>Metrics section<a class="hash-link" href="#metrics-section" title="Direct link to heading">#</a></h3><p>The metrics section allows you to specify and define the metrics that you&#x27;re collecting,
the statistical summaries that you&#x27;d like applied to them, and any filters that you need.
See the <a href="https://docs.telemetry.mozilla.org/datasets/jetstream.html" target="_blank" rel="noopener noreferrer">Jetstream docmentation at DTMO</a> for more details on the analysis window concept.</p><p>You can use the names of metrics defined in mozanalysis without redefining them.
See the <a href="https://mozilla.github.io/mozanalysis/api/metrics/desktop.html" target="_blank" rel="noopener noreferrer">mozanalysis metrics documentation</a>
for your platform for the set of defined metrics.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><div tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Metrics to compute for each daily analysis window.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Defined as a list of strings. The string should be the &quot;slug&quot; of the metric,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># which is the name of the Metric object defined in mozanalysis, or the name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># of the metric definition section in this config file (see below).</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">daily = []</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Metrics to compute for each weekly analysis window.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">weekly = [&quot;uri_count&quot;, &quot;retained&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Metrics to compute for each 28 days long analysis window</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">28_day = [&quot;uri_count&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Metrics to compute only for the overall analysis window.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">overall = [&quot;uri_count&quot;, &quot;search_count&quot;]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="defining-metrics"></a>Defining metrics<a class="hash-link" href="#defining-metrics" title="Direct link to heading">#</a></h3><p>You can define a new metric by adding a new section with a name like</p><p><code>[metrics.&lt;new_metric_slug&gt;]</code></p><p>For example, you could define a new metric based on a scalar named
<code>browser.engagement.cows_clicked</code> this way:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><div tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics.ever_clicked_cows]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># A clause of a SELECT expression. The expression must contain an aggregation function.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># The expression is evaluated with `GROUP BY client_id, branch` over an analysis window.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Interpreted as a Jinja2 template. The mozanalysis helper functions are available,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># so you could equivalently write the expression below like:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># select_expression = &quot;{{agg_sum(&quot;payload.processes.parent.scalars.browser_engagment_cows_clicked&quot;)}} &gt; 0&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># See https://mozilla.github.io/mozanalysis/api/metrics.html for details.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">select_expression = &quot;SUM(COALESCE(payload.processes.parent.scalars.browser_engagement_cows_clicked)) &gt; 0&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># The data source to use. You can use the slug of a data source defined in mozanalysis,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># or else define a new data source below.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">data_source = &quot;main&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Whether larger values of this metric are subjectively &quot;better&quot; or not.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># This defaults to true so you don&#x27;t need to specify it for engagement-type metrics</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># where we&#x27;re trying to encourage more of something. But for performance metrics,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># bigger is often worse, so you should set this to false.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">bigger_is_better = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># A friendly metric name displayed in dashboards.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">friendly_name = &quot;Cows clicked&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># A description that will be displayed by dashboards.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">description = &quot;Number of cows clicked&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Whether to compute the metric on an exposures basis, an enrollments basis, or both.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># An enrollments basis includes all users that enrolled. This is currently the default.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># An exposures basis includes all users that would have experienced a difference in their</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># user experience as a result of the experiment; it is a subset of enrollments.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># We may default to an exposures basis in the future.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exposure_basis = [&quot;exposures&quot;, &quot;enrollments&quot;]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>You should also add some sections to describe how your new metrics should be summarized for reporting.
You can do this by adding a statistics section to the metric for the statistic you want.</p><p>See <a href="/jetstream/statistics">Statistics</a> for a list of supported statistics and details about implementing your own.</p><p>This looks like:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><div tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics.ever_clicked_cows.statistics.binomial]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Sometimes it&#x27;s useful to specify a &quot;pre-treatment&quot; to drop extreme values</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># or perform a transformation. There is a list of these in the Jetstream wiki.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># They&#x27;re specified like this:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># pre_treatments = [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     {name = &quot;drop_nulls&quot;},   # ⚠️ Use this pretreatment judiciously!</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#                              # It can cause misleading results in</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#                              # the presence of churn. Engagement metrics</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#                              # should be coalesced to zero instead,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#                              # or you should handle zeros explicitly.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#     {name = &quot;log&quot;, base = 2},</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># They don&#x27;t make much sense for a binomial statistic, though.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># You can also change the default width of the confidence interval.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ci_width = 0.95</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>To put it all together, the metrics section (without any comments) for this probe could look like:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><div tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">weekly = [&quot;ever_clicked_cows&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics.ever_clicked_cows]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">select_expression = &quot;SUM(COALESCE(payload.processes.parent.scalars.browser_engagement_cows_clicked)) &gt; 0&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">data_source = &quot;main&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics.ever_clicked_cows.statistics.binomial]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="defining-data-sources"></a>Defining data sources<a class="hash-link" href="#defining-data-sources" title="Direct link to heading">#</a></h3><p>Most of the regular data sources are already defined in mozanalysis,
but you can define a new one in a similar way to how new metrics are defined.</p><p>Add a section that looks like:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><div tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[data_sources.my_cool_data_source]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># FROM expression - often just a fully-qualified table name. Sometimes a subquery.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from_expression = &quot;(SELECT client_id, experiments, submission_date FROM my_cool_table)&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># See https://mozilla.github.io/mozanalysis/api/metrics.html#mozanalysis.metrics.DataSource for details.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">experiments_column_type = &quot;native&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Then, your new metric can refer to it like <code>data_source = &quot;my_cool_data_source&quot;</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="defining-segments"></a>Defining segments<a class="hash-link" href="#defining-segments" title="Direct link to heading">#</a></h3><p>You can define new segments, just like you can define new metrics.</p><p>This looks like:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><div tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[segments.my_segment]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Note the aggregation function; these expressions are grouped over client_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">select_expression = &#x27;{{agg_any(&quot;is_default_browser&quot;)}}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">data_source = &quot;my_data_source&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[segments.data_sources.my_data_source]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from_expression = &#x27;(SELECT submission_date, client_id, is_default_browser FROM my_cool_table)&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Learn more about defining a segment data source in the <a href="https://mozilla.github.io/mozanalysis/api/segments.html#mozanalysis.segments.SegmentDataSource" target="_blank" rel="noopener noreferrer">mozanalysis documentation</a>.</p><p>The <code>clients_last_seen</code> table is particularly useful for segmentation because each client should be present on the <code>submission_date</code> when they enroll.
If you are not using <code>clients_last_seen</code>, you probably want to set the <code>window_start</code> argument for the segment data source to a value more negative than zero,
which controls how far back before enrollment mozanalysis will look to compute the segment expression.</p><p>For example, to aggregate over rows from the week prior to enrollment, the segment data source should be defined with <code>window_start = -7</code>.</p><p>To segment on fields in the telemetry environment, you can use the <code>event</code> ping table (not the derived <code>events</code> table) with no lookback period,
since the <code>event</code> ping that contains the enrollment event will necessarily be received
on the date of enrollment.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="outcome-snippets"></a>Outcome snippets<a class="hash-link" href="#outcome-snippets" title="Direct link to heading">#</a></h3><p>Outcome snippets, which define a collection of summaries with a common theme (e.g. &quot;performace&quot;, &quot;Picture in Picture use&quot;),
are stored in the <code>outcomes/</code> directory and file names serve as unique identifiers. Outcome snippets are organized in different
subdirectories that represent the application they are supporting, e.g. <code>fenix/</code> or <code>firefox_desktop/</code>.</p><p>Configuration files have a set of <a href="#defining-metrics"><code>[metrics]</code> definitions</a> and <a href="#defining-data-sources"><code>[data_sources]</code></a>.
A <code>friendly_name</code> and <code>description</code> are required at the top of the outcome snippet config file.</p><p>Unlike experiment configurations, the <code>[metrics]</code> section does not specify the analysis windows metrics
are computed for. Jetstream computes metrics defined in outcome snippets for weekly and overall
analysis windows.</p><p>Outcome snippets look, for example, like:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><div tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">friendly_name = &#x27;Example config&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">description = &#x27;Example outcome snippet&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics.total_amazon_search_count]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">select_expression = &quot;SUM(CASE WHEN engine like &#x27;amazon%&#x27; then sap else 0 end)&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">data_source = &quot;search_clients_engines_sources_daily&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics.total_amazon_search_count.statistics.bootstrap_mean]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics.total_amazon_search_count.statistics.deciles]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics.urlbar_amazon_search_count]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">select_expression = &quot;&quot;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SUM(CASE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        WHEN source = &#x27;alias&#x27; and engine like &#x27;amazon%&#x27; then sap</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        WHEN source = &#x27;urlbar&#x27; and engine like &#x27;amazon%&#x27; then sap</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        WHEN source = &#x27;urlbar-searchmode&#x27; and engine like &#x27;amazon%&#x27; then sap</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        else 0 end)&quot;&quot;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">data_source = &quot;search_clients_engines_sources_daily&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics.urlbar_amazon_search_count.statistics.bootstrap_mean]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics.urlbar_amazon_search_count.statistics.deciles]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/mozilla/experimenter-docs/edit/main/docs/jetstream/configuration.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/jetstream/outcomes"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Outcomes</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/jetstream/data-products"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Jetstream Data Products »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#about-configurations" class="table-of-contents__link">About configurations</a></li><li><a href="#landing-configurations" class="table-of-contents__link">Landing configurations</a></li><li><a href="#configuration-file-syntax" class="table-of-contents__link">Configuration file syntax</a><ul><li><a href="#custom-experiment-configurations" class="table-of-contents__link">Custom experiment configurations</a></li><li><a href="#experiment-section" class="table-of-contents__link">Experiment section</a></li><li><a href="#metrics-section" class="table-of-contents__link">Metrics section</a></li><li><a href="#defining-metrics" class="table-of-contents__link">Defining metrics</a></li><li><a href="#defining-data-sources" class="table-of-contents__link">Defining data sources</a></li><li><a href="#defining-segments" class="table-of-contents__link">Defining segments</a></li><li><a href="#outcome-snippets" class="table-of-contents__link">Outcome snippets</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 Mozilla Corporation</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a5111cd0.js"></script>
<script src="/assets/js/main.85d935e1.js"></script>
</body>
</html>